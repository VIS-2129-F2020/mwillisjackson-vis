---
title: "Assignment6_VIS"
author: "Megan Willis-Jackson"
date: "10/21/2020"
output: html_document
---

```{r load libraries, message=F, warning=F}
library(tidyverse)
library(sf)
library(leaflet)
library(htmltools)
library(htmlwidgets)
library(ggplot2)
library(ggthemes)
library(units)

```


```{r load data, message=F, warning=F}
leaflet_plane <- "+proj=longlat +datum=WGS84"

mbta_bus_route <- st_read("C:/Users/mwill/OneDrive - Harvard University/2020 - Fall/Spatial Analysis/InteractiveMaps/mbtabus/mbtabus/ARC", quiet = T) %>%
  st_transform(crs = leaflet_plane)

mbta_bus_stop <- st_read("C:/Users/mwill/OneDrive - Harvard University/2020 - Fall/Spatial Analysis/InteractiveMaps/mbtabus/mbtabus/PT", quiet = T) %>%
  st_transform(crs = leaflet_plane)

mbta_train_route <- st_read("C:/Users/mwill/OneDrive - Harvard University/2020 - Fall/Spatial Analysis/InteractiveMaps/mbta_rapid_transit/ARC", quiet = T) %>%
  st_transform(crs = leaflet_plane)

mbta_train_stop <- st_read("C:/Users/mwill/OneDrive - Harvard University/2020 - Fall/Spatial Analysis/InteractiveMaps/mbta_rapid_transit/NODE", quiet = T) %>%
  st_transform(crs = leaflet_plane)

south_boston <- st_read("C:/Users/mwill/OneDrive - Harvard University/2020 - Fall/Spatial Analysis/InteractiveMaps/SouthBoston_tract", quiet = T) %>%
  st_transform(crs = leaflet_plane)


```


```{r making sure it all looks good in ggplot, message=F, warning=F}
left_side <- st_bbox(south_boston)$xmin
right_side <- st_bbox(south_boston)$xmax
bottom_side <- st_bbox(south_boston)$ymin
top_side <- st_bbox(south_boston)$ymax

ggplot(south_boston) +
  geom_sf(aes(fill = GEOID),
          alpha = .5,
          show.legend = F) +
  geom_sf(data = mbta_bus_stop) +
  geom_sf(data = mbta_train_stop, color = "red") +
  geom_sf(data = mbta_train_route) +
  coord_sf(xlim = c(left_side, right_side),
           ylim = c(bottom_side, top_side), expand = F) +
  scale_fill_viridis_d() +
  theme_map()


```

```{r create summary variables, message=F, warning=F}
south_boston_bus <- mbta_bus_stop[south_boston,]
south_boston_train <- mbta_train_stop[south_boston,]

south_boston <- south_boston %>%
  mutate(num_bus = lengths(st_covers(south_boston, mbta_bus_stop)),
         num_train = lengths(st_covers(south_boston, mbta_train_stop)),
         num_stops = num_bus + num_train,
         area = set_units(st_area(south_boston), m^2),
         stop_density = as.numeric(num_stops / area))

ggplot(south_boston) +
  geom_sf(aes(fill=num_stops), color = NA) +
  geom_sf(data = south_boston_bus) +
  geom_sf(data = south_boston_train)

```

```{r more data, message=F, warning=F}
ma_wages_2018<- read.csv("C:/Users/mwill/OneDrive - Harvard University/2020 - Fall/Studio 1/Exercise 2/Data/Wages2013and2018/ACSST5Y2018.S1901_data_with_overlays_2020-09-24T123247.csv", stringsAsFactors = T)

ma_wages_2018$medianinc<- as.numeric(as.character(ma_wages_2018$S1901_C02_012E))

south_boston <- left_join(south_boston, ma_wages_2018, by = "GEOID2")
south_boston<- south_boston[,-c(23:149)]

south_boston$medianinc <- replace_na(south_boston$medianinc, 0)

```

```{r using leaflet, message=F, warning=F}
south_boston$describe <- paste("<b>",
                               "<p style='color:Black;'>",
                               south_boston$NAMELSAD,"</b>","</p>",
                               "<b>", 
                               ifelse(south_boston$num_stops > mean(south_boston$num_stops),
                                      "<p> <span style = 'color:Green;'>", 
                                      "<p> <span style = 'color:Red;'>"),
                               south_boston$num_stops,"</b>", "</span>", 
                               " bus/train stops",
                               "<br>",
                               "<b>",
                               ifelse(south_boston$stop_density >
                                      mean(south_boston$stop_density),
                                      "<span style = 'color:Green;'>",
                                      "<span style = 'color:Red;'>"),
                               prettyNum(south_boston$stop_density*5280, digits = 2),"</b>",
                               "stops per square mile","</span>",  
                               "<br>", 
                               "Median Income:","<b>",
                               ifelse(south_boston$medianinc==0,
                                      "<span style = 'color:Gray;'> Not Available",
                                      ifelse(south_boston$medianinc >
                                               mean(south_boston$medianinc),
                                             "<span style = 'color:Green;'>",
                                             "<span style = 'color:Red;'>")),
                               "$",prettyNum(south_boston$medianinc, 
                                             digits = 6, big.mark = ","),
                               "</span></b></p>") %>%
  lapply(htmltools::HTML)

tract_map <- leaflet(south_boston) %>%
  addProviderTiles(providers$Stamen.Terrain) %>%
  addPolygons(fillColor = "hotpink", stroke = F,
              highlightOptions = highlightOptions(fillColor = "hotpink",
                                                  fillOpacity = .6),
              label = ~describe) %>%
  addControl("Census Tracts in South Boston", position = "topright") 

tract_map

saveWidget(tract_map, file = "mbta_stops_southie.html")

```












