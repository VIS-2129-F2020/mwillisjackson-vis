---
title: "Assignment5_VIS"
author: "Megan Willis-Jackson"
date: "10/18/2020"
output: html_document
---

```{r load libraries, message=F, warning=F}
library(osmdata)
library(opentripplanner)
library(tidyverse)
library(sf)
library(ggthemes)
library(ggspatial)
library(raster)
library(units)
library(sp)
library(stringr)
library(rgeos)
library(tidygeocoder)
library(raster)
library(RStoolbox)
library(rgdal)

```

```{r location, message=F, warning=F}
opq(bbox = 'Nozay Pays de la Loire France') %>%
  add_osm_feature(key = 'highway') %>%
  osmdata_xml(file = 'OTP/graphs/default/Nozay_streets.osm')

opq(bbox = 'Nozay Pays de la Loire France') %>%
  add_osm_feature(key = 'landuse', value = 'farmland') %>%
  osmdata_xml(file = 'OTP/graphs/default/Nozay_farmland.osm')

opq(bbox = 'Nozay Pays de la Loire France') %>%
  add_osm_feature(key = 'landuse', value = 'meadow') %>%
  osmdata_xml(file = 'OTP/graphs/default/Nozay_meadow.osm')


france_proj <- "+proj=lcc +lat_1=49.50000000000001 +lat_0=49.50000000000001 +lon_0=0 +k_0=0.999877341 +x_0=600000 +y_0=200000 +a=6378249.2 +b=6356515 +towgs84=-168,-60,320,0,0,0,0 +pm=paris +units=m +no_defs"



```


```{r load otp features, message=F, warning=F}

nozay_street_features <- opq(bbox = 'Nozay Pays de la Loire France') %>%
  add_osm_feature(key = 'highway') %>%
  osmdata_sf()

nozay_farm_features <- opq(bbox = 'Nozay Pays de la Loire France') %>%
  add_osm_feature(key = 'landuse', value = 'farmland') %>%
  osmdata_sf()

nozay_meadow_features <- opq(bbox = 'Nozay Pays de la Loire France') %>%
  add_osm_feature(key = 'landuse', value = 'meadow') %>%
  osmdata_sf()

nozay_streets <- nozay_street_features$osm_lines  %>%
  st_transform(crs = france_proj)

nozay_farm <- nozay_farm_features$osm_polygons %>%
  st_transform(crs = france_proj)

nozay_meadow <- nozay_meadow_features$osm_polygons %>%
  st_transform(crs = france_proj)

ggplot(nozay_streets) +
  geom_sf(data = nozay_farm, fill = "gold", color = NA) +
  geom_sf(data = nozay_meadow, fill = "darkseagreen", color = NA) +
  geom_sf(alpha = .7)  +
  theme_map()


```

```{r import image, message=F, warning=F}
nozay_image <- stack("C:/Users/mwill/OneDrive/Documents/ArcGIS/Projects/GeoreferencingVIS/Nozay_hand_8.tif")

nozay_image <- projectRaster(nozay_image,
                             crs = crs(france_proj))

ggRGB(nozay_image, r=1,g=2,b=3, alpha = .5) 
  coord_sf(crs = france_proj)

ggplot(nozay_streets) +
  #annotation_map_tile(type = "hotstyle") +
  ggRGB(nozay_image, r=1, g=2, b=3, ggLayer = T, alpha = 1) +
  geom_sf(alpha = .1) +
  geom_sf(data = nozay_farm, fill = "gold", color = NA, alpha = .7) +
  geom_sf(data = nozay_meadow, fill = "seagreen", color = NA, alpha = .7) +
  coord_sf(xlim = c(nozay_image@extent@xmin, nozay_image@extent@xmax),
           ylim = c(nozay_image@extent@ymin, nozay_image@extent@ymax)) +
  annotation_north_arrow(location = "tr", style = north_arrow_fancy_orienteering()) +
  annotation_scale(location = "br") +
  theme_map()

```






